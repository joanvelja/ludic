# Plan: Audit Chat Templating Usage
> From: Planner | To: Doer | Timestamp: 2026-01-21 14:22:22
> Upstream Directive: user request in session

## Objective

**Deliverable**: Findings on chat templating usage, including locations and any misuse of add_generation_prompt or template ordering.
**Definition of Done**: Enumerated file/line refs for chat template usage + assessment of correctness vs expectations.

## Pre-Execution Checklist

Before starting, Doer should verify:
- [ ] Repo root is `/Users/joalja/Documents/Github/ext/ludic`
- [ ] `CONSIDERATIONS.md` is read and in mind

## Execution Plan

### Phase 1: Locate chat templating usage
**Goal**: Identify all calls to tokenizer chat templates and related formatting.

| Step | Action | Target | Details | Verification |
|------|--------|--------|---------|--------------|
| 1.1 | Search | `src/` | `rg "apply_chat_template|chat_template|add_generation_prompt"` | Results list collected |
| 1.2 | Inspect | Each hit | Confirm ordering of messages and prompt insertion | Notes per file |
| 1.3 | Cross-check | `examples/` and `scripts/` | Same search | Hits reviewed |

**Phase 1 Checkpoint**: All chat-templating related hits reviewed and categorized.

### Phase 2: Assess correctness
**Goal**: Flag any add_generation_prompt placement issues or risky patterns.

| Step | Action | Target | Details | Verification |
|------|--------|--------|---------|--------------|
| 2.1 | Evaluate | Each usage | Determine if add_generation_prompt appended after assistant vs after user | Per-usage verdict |
| 2.2 | Summarize | Findings | List correct vs questionable patterns | Summary ready |

**Phase 2 Checkpoint**: Verdict + rationale ready with file/line refs.

## Constraints

### Must Do
- [ ] Use file/line references in findings
- [ ] Keep CONSIDERATIONS.md philosophy in mind

### Must NOT Do
- [ ] Do not modify code

## Escalation Protocol

| Trigger | Action |
|---------|--------|
| Unclear template semantics | `/escalate planner` with question |
| Cannot find any chat templating | `/escalate planner` with confirmation |

## Verification Checklist

When complete, Doer should verify:
- [ ] All `apply_chat_template` usages reviewed
- [ ] add_generation_prompt behavior assessed per usage

## Handoff Instruction

When execution is complete:
- If all verification passes: `/escalate planner` with completion summary
- If blocked: `/escalate planner` with blocker details

Estimated execution complexity: Medium
Estimated time: 30-45 min
